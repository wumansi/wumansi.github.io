## Redis秒杀场景环节应用

秒杀活动前，商品详情页的瞬时请求量会剧增，一般把商品详情页的页面静态化，然后使用CDN或浏览器缓存把静态化的元素缓存起来，减轻服务器端的压力。
- CDN：内容分发网络，根据用户请求查找离用户最近的服务节点，在用户所属区域距离用户最近的服务器附近部署缓存服务器，缓存静态资源。

秒杀活动开始时，会产生大量的并发请求查询库存（库存查询、库存扣减、订单处理），并发压力在库存查询。可以使用redis保存库存量，请求可以直接从redis中读取库存并进行查验。

订单处理涉及到的数据表较多，要保证处理的事务性，需在数据库中完成。

- 查验库存量跟扣减库存两个操作需要保证原子性。

Redis支持高并发，同时可以使用切片集群，用不同的实例保存不同商品的库存，这样可以避免所有的秒杀请求集中在一个实例上。

- 原子性操作方式：
1. LUA脚本，在客户端使用`EVAL`命令来执行脚本；
2. 分布式锁，保证客户端并发访问的互斥性（可以使用切片集群中的不同实例来分别保存分布式锁和商品库存信息，秒杀请求会首先访问分布式锁的实例，
没拿到锁就不会查询商品库存，减轻库存信息的实例的压力)
